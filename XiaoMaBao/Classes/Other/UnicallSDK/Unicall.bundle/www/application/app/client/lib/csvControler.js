(function(){

/////////////////////////////////////////////////////////////////////////
//                                                                     //
// client/lib/csvControler.js                                          //
//                                                                     //
/////////////////////////////////////////////////////////////////////////
                                                                       //
/**                                                                    //
 * Created by lil on 16-2-24.                                          //
 */                                                                    //
// Generated by CoffeeScript 1.10.0                                    //
//定义visitor                                                            //
(function () {                                                         // 6
  this.csvControler = new ((function () {                              // 7
    function _Class() {}                                               // 8
                                                                       //
    var showCSV = function (rid) {                                     // 11
      console.log("hide your room", rid);                              // 12
      Session.set("roomHasHided", true);                               // 13
      //app跳转                                                          //
      if (Meteor.isCordova) {                                          // 15
        //解决访客结束后字会闪的问题                                                //
        if (Session.get("whoEndMsg") != 'visitor') {                   // 17
          Session.set("whoEndMsg", "agent");                           // 18
          FlowRouter.go('/rating?close=agent');                        // 19
        }                                                              //
      } else {                                                         //
        if (Session.get("whoEndMsg") != 'visitor') {                   // 22
          Session.set("whoEndMsg", "agent");                           // 23
          $(".xCover").css("display", "block");                        // 24
          $(".survey-submit").removeClass("agent-survey").addClass("agent-survey");
          Session.set("agent-closing", true);                          // 26
        }                                                              //
      }                                                                //
    };                                                                 //
    var listen = function (key) {                                      // 30
      notifyStream.on(key + "/hide", showCSV);                         // 31
    };                                                                 //
    var onRoomChanged = function (newRid) {                            // 33
      notifyStream.removeListener(visitor.getRoom() + "/hide", showCSV);
      visitor.setRoom(newRid);                                         // 35
      notifyStream.on(visitor.getRoom() + "/hide", showCSV);           // 36
    };                                                                 //
                                                                       //
    _Class.prototype.listen = listen;                                  // 39
                                                                       //
    _Class.prototype.onRoomChanged = onRoomChanged;                    // 41
                                                                       //
    return _Class;                                                     // 43
  })())();                                                             //
}).call(this);                                                         //
/////////////////////////////////////////////////////////////////////////

}).call(this);
