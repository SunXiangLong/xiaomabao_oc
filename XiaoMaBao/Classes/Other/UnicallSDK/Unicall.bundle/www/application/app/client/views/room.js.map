{"version":3,"sources":["meteor://💻app/client/views/room.js"],"names":[],"mappings":"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","file":"/client/views/room.js","sourcesContent":["// Generated by CoffeeScript 1.10.0\n(function () {\n  var isSatisfactionOnSubmit = false;\n  var surveyByAgent = function (survey) {\n    var count = 1;\n    Tracker.autorun(function (c) {\n      if (!Session.get(\"roomHasHided\")) {\n        console.log(\"wait for hide room:\" + count);\n        return;\n      }\n      c.stop();\n      isSatisfactionOnSubmit = true;\n      Meteor.call(\"saveSatisfaction\", {\n        channelId: \"webchat\",\n        tenantId: \"\",\n        messageId: visitor.getRoom(),\n        surveyResult: survey\n      }, function (error, result) {\n        console.log(\"AgentHideRoom:\", error, result);\n        isSatisfactionOnSubmit = false;\n        $(\".xCover\").css(\"display\", \"none\");\n        $(\".survey-submit\").removeClass(\"agent-survey\");\n        if (survey !== \"-1\") {\n          document.getElementById(\"submit-success\").style.display = \"block\";\n        }\n        Session.set(\"agent-closing\", false);\n        Session.set(\"whoEndMsg\", \"\");\n      });\n    });\n  }\n  var surveyByVisitor = function (survey) {\n    Meteor.call(\"visitorHideRoom\", visitor.getRoom(), function (err, data) {\n      console.log(\"visitorHideRoom:\", err, data);\n      if (!err) {\n        Session.set(\"roomHasHided\", true);\n        surveyByAgent(survey);\n      } else {\n        alert(\"错误\");\n      }\n    });\n  };\n  var callParentToggleWindo = function () {\n    Session.set(\"hasSendMsg\", false);\n    //Session.set('chat-room-title', Meteor.settings.public.tenant_livechat_settings ? Meteor.settings.public.tenant_livechat_settings['chat-title-text'] : '开始聊天');\n    // Session.set('chat-room-title', Meteor.settings.public.tenant_livechat_settings ? Meteor.settings.public.tenant_livechat_settings['mini-title-text'] : \"您需要帮助吗?\");\n    // Session.set('livechat-closed', true);\n    outerAgent.toggleWindow();\n  };\n\n\n  Template.room.helpers({\n    getClosingMsg: function () {\n\n      return (Session.get(\"agent-closing\") === true && isSatisfactionOnSubmit === false) ?\n        Meteor.settings.public.tenant_livechat_settings.surveyByAgent :\n        Meteor.settings.public.tenant_livechat_settings.surveyByVisitor;\n\n    },\n    getAbUrl: function (url) {\n      return new Tools().getPath() + url;\n    },\n    messages: function () {\n      //rid: visitor.getRoom(),\n      return ChatMessage.find({\n        t: {\n          '$ne': 't'\n        }\n      }, {\n        sort: {\n          ts: 1\n        }\n      });\n    },\n    isCordova: function () {\n      return Meteor.isCordova;\n    },\n    supportUploadFile: function () {\n      return navigator.userAgent.indexOf('MSIE 8.0') < 0 && navigator.userAgent.indexOf('MSIE 9.0') < 0\n    },\n    title: function () {\n      return Meteor.isCordova ? Meteor.settings.public.tenant_livechat_settings.chatTitle : Meteor.settings.public.tenant_livechat_settings['chat-title-text']\n    },\n    ifOpened: function () {\n      if (Session.get('livechat-closed') === true) {\n        return false;\n      }\n      return true;\n    },\n    color: function () {\n      var ref;\n      //if (!Template.instance().subscriptionsReady()) {\n      //  return 'transparent';\n      //}\n      /*return ((ref = Settings.findOne('Livechat_title_color')) != null ? ref.value : void 0) || '#999999';*/\n      return Meteor.settings.public.tenant_livechat_settings ? Meteor.settings.public.tenant_livechat_settings['title-bg-color'] : '#434a50';\n      //return ((ref = Settings.findOne('Livechat_title_color')) != null ? ref.value : void 0) || '#C1272D';\n    },\n    fontColor: function () {\n      return Meteor.settings.public.tenant_livechat_settings ? Meteor.settings.public.tenant_livechat_settings['title-font-color'] : \"#ffffff\";\n    },\n    time: function () {\n      if (Session.get('startTime'))\n        return moment(Session.get('startTime')).format('YYYY.MM.DD  HH : mm : ss')\n    },\n    refreshNotice: function () {\n      return Session.get('refresh-notice') === 'loading';\n    },\n    browserSupportNoticer: function () {\n      return Session.get(\"browser-support-notice-show\") === true;\n    },\n    getAudioUrl: function () {\n      return Session.get('audioUrl');\n    },\n    isCordova: function () {\n      return Meteor.isCordova;\n    }\n  });\n\n  Template.room.events({\n    \"click #btn_cancel\": function () {\n      if (Session.get(\"whoEndMsg\") && Session.get(\"whoEndMsg\") == \"agent\") {\n        surveyByAgent(\"-1\");\n      } else {\n        $(\".xCover\").css(\"display\", \"none\");\n      }\n    },\n    \"click #btn_submit\": function () {\n      var sd = Session.get(\"SatisfactionDegree\");\n      if (Session.get(\"whoEndMsg\") == \"visitor\") {\n        surveyByVisitor(sd);\n      } else {\n        surveyByAgent(sd);\n      }\n    },\n    \"click #btn_okxxx\": function () {\n      document.getElementById(\"submit-success\").style.display = \"none\";\n      callParentToggleWindo();\n    },\n    \"click input[type='radio']\": function (e) {\n      var sd = \"\";\n      switch (e.target.value) {\n        case \"非常满意\":\n          sd = 5;\n          break;\n        case \"满意\":\n          sd = 4;\n          break;\n        case \"一般\":\n          sd = 3;\n          break;\n        case \"不满意\":\n          sd = 2;\n          break;\n        case \"非常不满意\":\n          sd = 1;\n          break;\n      }\n      Session.set(\"SatisfactionDegree\", sd);\n    },\n    \"click #btn_over\": function (e) {\n      e.stopPropagation()\n      e.preventDefault();\n      if (visitor.getRoom() && Session.get(\"hasSendMsg\")) {\n        Session.set(\"whoEndMsg\", \"visitor\");\n        $(\".xCover\").css(\"display\", \"block\");\n      } else {\n        //Session.set('chat-room-title', Meteor.settings.public.tenant_livechat_settings ? Meteor.settings.public.tenant_livechat_settings['mini-title-text'] : \"您需要帮助吗?\");\n        //Session.set('livechat-closed', true);\n        Session.set(\"hasSendMsg\", false);\n        outerAgent.closeWindow();\n        console.log(\"房间尚未建立！\");\n      }\n    },\n    \"click #btn_close\": function (event) {\n      event.stopPropagation();\n      event.preventDefault();\n      surveyByVisitor(\"-1\");\n      callParentToggleWindo();\n      /*Session.set(\"roomHasHided\", true);\n       surveyByAgent(null, function () {\n       $(\".xCover\").css(\"display\", \"none\");\n       callParentToggleWindo();\n       });*/\n    },\n    \"click #btn_send\": function () {\n      return Template.instance().chatMessages.clickButton(visitor.getRoom(), Template.instance().find('.input-message'), Template.instance());\n    },\n    'keyup .input-message': function (event) {\n      var inputScrollHeight;\n      Template.instance().chatMessages.keyup(visitor.getRoom(), event, Template.instance());\n      inputScrollHeight = $(event.currentTarget).prop('scrollHeight');\n      if (inputScrollHeight > 70) {\n        return $(event.currentTarget).height($(event.currentTarget).val() === '' ? '15px' : (inputScrollHeight >= 200 ? inputScrollHeight - 50 : inputScrollHeight - 20));\n      }\n    },\n    'keydown .input-message': function (event) {\n      return Template.instance().chatMessages.keydown(visitor.getRoom(), event, Template.instance());\n    },\n    'click .new-message': function (e) {\n      Template.instance().atBottom = true;\n      return Template.instance().find('.input-message').focus();\n    },\n    'change #uploadFileInput': function (event) {\n      var e = event || event.originalEvent;\n      var files = e.target.files;\n      if (files === undefined || files === null || files.length === 0) {\n        if (e.dataTransfer) {\n          files = e.dataTransfer.files || [];\n        }\n      }\n      if (files && files.length !== 0) {\n        var filesToUpload = [];\n        for (var i = 0; i < files.length; i++) {\n          var file = files[i];\n          filesToUpload.push({\n            file: file,\n            name: file.name\n          });\n\n          console.log('file selected->' + file.name);\n        }\n        slingshotFileUpload(filesToUpload);\n        //to submit\n\n      }\n    },\n    'click .title': function () {\n      localStorage.setItem('unreadMessageNumber', 0);\n      $(\".msgcount\").hide(0);\n      //if (Session.get('chat-room-title') === (Meteor.settings.public.tenant_livechat_settings ? Meteor.settings.public.tenant_livechat_settings['chat-title-text'] : '开始聊天')) {\n      //  Session.set('chat-room-title', Meteor.settings.public.tenant_livechat_settings ? Meteor.settings.public.tenant_livechat_settings['mini-title-text'] : '您需要帮助吗?');\n      //  Session.set('livechat-closed', true);\n      //} else {\n      //  Session.set('chat-room-title', Meteor.settings.public.tenant_livechat_settings ? Meteor.settings.public.tenant_livechat_settings['chat-title-text'] : '开始聊天');\n      //  Session.set('livechat-closed', false);\n      //}\n      return outerAgent.toggleWindow();\n    },\n    'click .error': function (e) {\n      return $(e.currentTarget).removeClass('show');\n    },\n    'click #showIE8NoticeButton': function () {\n      if (Session.get(\"browser-support-notice-show\") === true)\n        Session.set(\"browser-support-notice-show\", false);\n      else\n        Session.set(\"browser-support-notice-show\", true);\n    },\n    'click .system-notice': function () {\n      Session.set(\"browser-support-notice-show\", false);\n    },\n    'click .msgTime': function (e) {\n      return $(e.currentTarget).addClass(\"hideMsgTime\")\n    }\n  });\n\n  /**\n   *  订阅房间，并创建房间\n   */\n  Template.room.onCreated(function () {\n    var self;\n    self = this;\n    self.autorun(function () {\n      return self.subscribe('livechat:visitorRoom', visitor.getToken(), function () {\n        var room;\n        room = ChatRoom.findOne();\n        if (room != null && room.open) {\n          visitor.setRoom(room._id);\n          return RoomHistoryManager.getMoreIfIsEmpty(room._id);\n        }\n      });\n    });\n\n\n    self.subscribe('settings', ['Livechat_title', 'Livechat_title_color']);\n    return self.atBottom = true;\n  });\n  Template.room.onRendered(function () {\n    Session.set(\"SatisfactionDegree\", 5);\n    /*默认满意度为非常满意*/\n    this.chatMessages = new ChatMessages;\n    Session.set('chat-room-title', Meteor.settings.public.tenant_livechat_settings ? Meteor.settings.public.tenant_livechat_settings['chat-title-text'] : '开始聊天');\n    //parentCall('toggleWindow');\n    this.chatMessages.init(this.firstNode);\n\n    //播放条\n    var player = $('#voice-player')[0];\n    player.addEventListener(\"ended\", function () {\n      //player.currentTime = 0;\n      $('.message .msgBody .playing').removeClass('playing');\n    });\n  });\n  Template.room.onRendered(function () {\n    var newMessage, onscroll, template, wrapper, loadHistory;\n    wrapper = this.find('.wrapper');\n    newMessage = this.find(\".new-message\");\n    template = this;\n    onscroll = _.throttle(function () {\n      return template.atBottom = wrapper.scrollTop >= wrapper.scrollHeight - wrapper.clientHeight;\n    }, 200);\n    loadHistory = _.throttle(function () {\n      if (wrapper.scrollTop === 0) {\n        CharRecords.load(function (hasMore) {\n          if (hasMore === true)\n            wrapper.scrollTop = 30;\n        });\n\n      }\n    }, 1000);\n    var tenantId = new Tools().getUrlParameterByName('tenant_id');\n    Meteor.call(\"getWebChatConfig\", tenantId, true, function (err, data) {\n      var welcomes = \"您好,请问有什么可以帮到您呢？\";\n      var closing = \"本次会话已经结束，感谢您使用在线云客服，再见！\";\n      var advertisement = \"欢迎使用荣联.云客服！\";\n      if (!err && data.code === 0) {\n        welcomes = data.data.welcomes != \"\" && data.data.welcomes ? data.data.welcomes : welcomes;\n        closing = data.data.closing != \"\" && data.data.closing ? data.data.closing : closing;\n        advertisement = data.data.advertisement != \"\" && data.data.advertisement ? data.data.advertisement : advertisement;\n      }\n      if (Meteor.isCordova) {\n        welcomes = Meteor.settings.public.tenant_livechat_settings.welcomes;\n        closing = Meteor.settings.public.tenant_livechat_settings.surveyByAgent;\n        advertisement = Meteor.settings.public.tenant_livechat_settings.advertisement;\n      }\n      Session.set(\"WebChatConfig\", {\n        advertisement: advertisement,\n        welcomes: welcomes,\n        closing: closing\n      });\n      console.log(\"WebChatConfig:\", Session.get(\"WebChatConfig\"));\n      Meteor.setTimeout(function () {\n        var message = {};\n        message.rid = visitor.getRoom();\n        message.msg = Meteor.settings.public.tenant_livechat_settings.advertisement;\n        message.ts = new Date(Date.now() + (TimeSync.isSynced() ? TimeSync.serverOffset() : 0));\n        message.u = {\n          _id: \"\" + new Date().getTime(),\n          username: 'Agent',\n          name: '  '\n        };\n        message.temp = false;\n        ChatMessage.insert(message);\n      }, 100);\n\n    });\n\n\n    Meteor.setInterval(function () {\n      if (template.atBottom) {\n        wrapper.scrollTop = wrapper.scrollHeight - wrapper.clientHeight;\n        //return newMessage.className = \"new-message not\";\n      }\n    }, 100);\n\n    wrapper.addEventListener('touchstart', function () {\n      return template.atBottom = false;\n    });\n    wrapper.addEventListener('touchend', function () {\n      return onscroll();\n    });\n    wrapper.addEventListener('scroll', function () {\n      template.atBottom = false;\n      loadHistory();\n      return onscroll();\n    });\n    wrapper.addEventListener('mousewheel', function () {\n      template.atBottom = false;\n      return onscroll();\n    });\n    return wrapper.addEventListener('wheel', function () {\n      template.atBottom = false;\n      return onscroll();\n    });\n  });\n\n}).call(this);\n"]}