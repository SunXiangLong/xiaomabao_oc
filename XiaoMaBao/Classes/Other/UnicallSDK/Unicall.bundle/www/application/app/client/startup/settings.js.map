{"version":3,"sources":["meteor://💻app/client/startup/settings.js"],"names":[],"mappings":"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","file":"/client/startup/settings.js","sourcesContent":["/**\n * Created by lil on 16/4/7.\n */\n(function() {\n  Meteor.startup(function() {\n    if(Meteor.isCordova){\n      Meteor.settings=Meteor.settings||{};\n      Meteor.settings.public=Meteor.settings.public||{};\n      Meteor.settings.public.tenant_livechat_settings=Meteor.settings.public.tenant_livechat_settings||{\"mini-title-text\":\"您需要帮助吗?\",\"chat-title-text\":\"开始聊天\",\"ticket-title-text\":\"欢迎留言\",\"title-bg-color\":\"#434a50\",\"title-font-color\":\"#FFF\",\"display-model\":\"border\"};\n      outerAgent.registerCallbackOnLivechatReady(function(appInfo){\n        Meteor.call('load-app-setting',appInfo.tenantId,appInfo.appKey,function(err,res){\n          if(err){\n            console.log(err)\n          }else{\n            if(Meteor.settings.public.tenant_livechat_settings)\n              Meteor.settings.public.tenant_livechat_settings = res.settings;\n            Meteor.settings.public.unicallAppKey = appInfo.appKey;\n            if(res.hasOperator === true){\n              FlowRouter.go('index', null, {tenant_id: btoa(appInfo.tenantId)});\n            }else{\n              FlowRouter.go('ticket', null, {tenant_id: btoa(appInfo.tenantId)});\n            }\n          }\n        })\n      });\n      outerAgent.registerCallbackOnSignReady(function(accessInfo){\n        accessInfo.tenantId;\n        accessInfo.appKey;\n        accessInfo.signature;\n        accessInfo.time;\n        accessInfo.expireTime;\n        Meteor.call('verify-app-agent',accessInfo,function(err,res){\n          if(err){\n            outerAgent.signACK({success:false});\n          }else{\n            outerAgent.signACK(res);\n          }\n        })\n      });\n      outerAgent.registerCallbackOnToggleWindow(function(){\n        if(FlowRouter.getRouteName() === 'ticket'){\n          Meteor.call('load-active-agent-count',Meteor.settings.public.tenant_livechat_settings.tenantId,function(error,result){\n            if(result && result > 0){\n              FlowRouter.go('index', null, {tenant_id: btoa(Meteor.settings.public.tenant_livechat_settings.tenantId)});\n            }\n          });\n        }\n      });\n      outerAgent.registerCallbackOnUserInfo(function(userInfo){\n        //暂时放在前台处理,今后应该避免前台存储\n        //Meteor.settings.public.appUsername = userInfo.nickname||'';\n        Meteor.settings.public.appUsername = userInfo.nickname||'';\n        if(Meteor.user()){\n          Meteor.call('update-visitor-name',userInfo.nickname,function(err,result){\n            console.log(err);\n          })\n        }else{\n          outerAgent.cacheUniqueUserInfo(userInfo);\n        }\n      });\n      outerAgent.registerCallbackOnUserInterest(function(userInterest){\n        userInterest.iconUrl;\n        userInterest.url;\n        userInterest.title;\n        userInterest.desc;\n        outerAgent.cacheUniqueSystemMessage({\n          msg: userInterest.title||'',\n          type: \"merchandise\",\n          token: visitor.getToken(),\n          clientType:Meteor.isCordova?device.platform:'webchat',\n          data:{\n            iconUrl:userInterest.iconUrl,\n            url:userInterest.url,\n            title:userInterest.title,\n            content:userInterest.desc\n          }\n        });\n      });\n      if(Meteor.settings.public.DevTenantId){\n        ////workbench接收签名请求\n        outerAgent.addEventListener('serverSign',function(data){\n          /*@\"signature\": __signature_at_backend_server__,\n           @\"appKey\":__app_key__,\n           @\"tenantId\":tenantId};UnicallAppInfo937486515*/\n          Meteor.call('sign-app-agent',data.appKey,function(err,res){\n            if(err){\n              console.log(err)\n            }else{\n              var sign = res;\n              outerAgent.sendMessage('serverSign',{appKey:data.appKey,tenantId:data.tenantId,sign:sign});\n            }\n          })\n        });\n      }\n      //ready之前需要trigger register\n      visitor.register();\n      outerAgent.ready();\n      if(Meteor.settings.public.DevTenantId){\n        outerAgent.sendMessage('Mock ServerSign',{appKey:\"d1d5d65c-27b5-407c-9773-30f383162afe\",tenantId:Meteor.settings.public.DevTenantId})\n      }\n      //outerAgent.mock.sendUserInterest({iconUrl:\"123\",url:\"456\",title:'你好',desc:\"描述123\"});\n      /*var agent = getUnicallAppInfoAgent();\n      agent.registerCallbackOnSignReady(function(info){\n        /!*@\"signature\": __signature_at_backend_server__,\n         @\"appKey\":__app_key__,\n         @\"tenantId\":tenantId};UnicallAppInfo937486515*!/\n        Meteor.call('verify-app-agent',info,function(err,res){\n          if(err){\n            outerAgent.signACK({success:false});\n          }else{\n            outerAgent.signACK({success:true});\n            if(Meteor.settings.public.tenant_livechat_settings)\n              Meteor.settings.public.tenant_livechat_settings = res.settings;\n            Meteor.settings.public.unicallAppKey = info.appKey;\n            if(res.hasOperator === true){\n              FlowRouter.go('index', null, {tenant_id:info.tenantId});\n            }else{\n              FlowRouter.go('ticket', null, {tenant_id:info.tenantId});\n            }\n          }\n        })\n      });\n      agent.addEventListener('serverSign',function(data){\n        /!*@\"signature\": __signature_at_backend_server__,\n         @\"appKey\":__app_key__,\n         @\"tenantId\":tenantId};UnicallAppInfo937486515*!/\n        Meteor.call('sign-app-agent',data.appKey,function(err,res){\n          if(err){\n            console.log(err)\n          }else{\n            var sign = res;\n            agent.sendMessage('serverSign',{appKey:data.appKey,tenantId:data.tenantId,sign:sign});\n          }\n        })\n      });\n      agent.livechatLoadReady();\n      if(Meteor.settings.public.DevTenantId){\n        agent.sendMessage('Mock ServerSign',{appKey:\"123456789\",tenantId:Meteor.settings.public.DevTenantId})\n      }*/\n\n\n    }\n    else{\n\n    }\n  });\n\n}).call(this);\n"]}