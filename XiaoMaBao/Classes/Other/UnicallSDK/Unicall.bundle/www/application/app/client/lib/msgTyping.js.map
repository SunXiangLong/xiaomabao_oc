{"version":3,"sources":["meteor://ðŸ’»app/client/lib/msgTyping.js"],"names":[],"mappings":"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","file":"/client/lib/msgTyping.js","sourcesContent":["// Generated by CoffeeScript 1.10.0\n(function() {\n  this.MsgTyping = (function() {\n    var addStream, dep, get, renew, renewTimeout, selfTyping, start, stop, stream, timeout, timeouts, usersTyping;\n    stream = new Meteor.Stream('typing');\n    timeout = 15000;\n    timeouts = {};\n    renew = true;\n    renewTimeout = 10000;\n    selfTyping = new ReactiveVar(false);\n    usersTyping = {};\n    dep = new Tracker.Dependency;\n    addStream = function(room) {\n      var ref;\n      if (_.isEmpty((ref = usersTyping[room]) != null ? ref.users : void 0)) {\n        usersTyping[room] = {\n          users: {}\n        };\n        return stream.on(room, function(typing) {\n          var ref1, users;\n          if ((typing != null ? typing.username : void 0) !== ((ref1 = Meteor.user()) != null ? ref1.username : void 0)) {\n            if (typing.start) {\n              users = usersTyping[room].users;\n              users[typing.username] = Meteor.setTimeout(function() {\n                delete users[typing.username];\n                usersTyping[room].users = users;\n                return dep.changed();\n              }, timeout);\n              usersTyping[room].users = users;\n              return dep.changed();\n            } else if (typing.stop) {\n              users = usersTyping[room].users;\n              delete users[typing.username];\n              usersTyping[room].users = users;\n              return dep.changed();\n            }\n          }\n        });\n      }\n    };\n    Tracker.autorun(function() {\n      if (visitor.getRoom()) {\n        return addStream(visitor.getRoom());\n      }\n    });\n    start = function(room) {\n      var ref;\n      if (!renew) {\n        return;\n      }\n      setTimeout(function() {\n        return renew = true;\n      }, renewTimeout);\n      renew = false;\n      selfTyping.set(true);\n      stream.emit('typing', {\n        room: room,\n        username: (ref = Meteor.user()) != null ? ref.username : void 0,\n        start: true\n      });\n      clearTimeout(timeouts[room]);\n      return timeouts[room] = Meteor.setTimeout(function() {\n        return stop(room);\n      }, timeout);\n    };\n    stop = function(room) {\n      var ref;\n      renew = true;\n      selfTyping.set(false);\n      if ((timeouts != null ? timeouts[room] : void 0) != null) {\n        clearTimeout(timeouts[room]);\n        timeouts[room] = null;\n      }\n      return stream.emit('typing', {\n        room: room,\n        username: (ref = Meteor.user()) != null ? ref.username : void 0,\n        stop: true\n      });\n    };\n    get = function(room) {\n      var users;\n      dep.depend();\n      if (!usersTyping[room]) {\n        usersTyping[room] = {\n          users: {}\n        };\n      }\n      users = usersTyping[room].users;\n      return _.keys(users) || [];\n    };\n    return {\n      start: start,\n      stop: stop,\n      get: get,\n      selfTyping: selfTyping\n    };\n  })();\n\n}).call(this);\n"]}