{"version":3,"sources":["meteor://üíªapp/client/views/rating.js"],"names":[],"mappings":";;;;;;;;;;;;AAIA,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC;AACtB,YAAU,EAAC,YAAU;AACnB,cAAU,CAAC,eAAe,EAAE,CAAC;AAC7B,QAAI,KAAK,GAAG,UAAU,CAAC,OAAO,EAAE,CAAC,WAAW,CAAC,KAAK,IAAI,OAAO,CAAC;AAC9D,QAAG,KAAK,IAAI,SAAS,EAAC;AACpB,aAAO,IAAI,CAAC;KACb;GACF;AACD,SAAO,EAAC,YAAU;AAChB,WAAO,MAAM,CAAC,QAAQ,UAAO,CAAC,wBAAwB,CAAC,SAAS,CAAC;GAClE;AACD,YAAU,EAAC,YAAU;AACnB,cAAU,CAAC,eAAe,EAAE,CAAC;AAC7B,QAAI,KAAK,GAAG,UAAU,CAAC,OAAO,EAAE,CAAC,WAAW,CAAC,KAAK,IAAI,OAAO,CAAC;AAC9D,WAAO,KAAK,KAAI,SAAS,GAAC,MAAM,CAAC,QAAQ,UAAO,CAAC,wBAAwB,CAAC,eAAe,GAAE,MAAM,CAAC,QAAQ,UAAO,CAAC,wBAAwB,CAAC,aAAa,CAAC;GAC1J;CACF,CAAC,CAAC;;AAEH,IAAI,YAAY,GAAG,UAAS,MAAM,EAAC;AACjC,MAAI,QAAQ,GAAG,MAAM,CAAC,QAAQ,UAAO,CAAC,wBAAwB,CAAC,QAAQ,IAAI,EAAE,CAAC;AAC9E,QAAM,CAAC,IAAI,CAAC,kBAAkB,EAAE;AAC9B,aAAS,EAAE,SAAS;AACpB,YAAQ,EAAE,QAAQ;AAClB,aAAS,EAAE,OAAO,CAAC,OAAO,EAAE;AAC5B,gBAAY,EAAE,MAAM;GACrB,EAAE,UAAU,KAAK,EAAE,MAAM,EAAE;AAC1B,QAAG,MAAM,EAAC;AACR,gBAAU,CAAC,EAAE,CAAC,QAAQ,EAAC,EAAC,IAAI,EAAC,UAAU,EAAC,EAAC,EAAC,MAAM,EAAC,MAAM,EAAC,CAAC,CAAC;KAC3D;GACF,CAAC,CAAC;CACJ,CAAC;;;AAGF,IAAI,QAAQ,GAAG,UAAS,MAAM,EAAC,QAAQ,EAAC;AACtC,MAAG,UAAU,CAAC,OAAO,EAAE,CAAC,WAAW,CAAC,KAAK,IAAI,SAAS,EAAC;AACrD,WAAO,CAAC,GAAG,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;AACpC,UAAM,CAAC,IAAI,CAAC,iBAAiB,EAAE,OAAO,CAAC,OAAO,EAAE,EAAE,UAAU,KAAK,EAAC,MAAM,EAAE;AACxE,kBAAY,CAAC,MAAM,CAAC,CAAC;AACrB,UAAG,OAAO,QAAQ,IAAI,UAAU,EAAC;AAC/B,gBAAQ,EAAE,CAAC;OACZ;KACF,CAAC,CAAC;GACJ,MAAI;AACH,gBAAY,CAAC,MAAM,CAAC,CAAC;AACrB,QAAG,OAAO,QAAQ,IAAI,UAAU,EAAC;AAC/B,cAAQ,EAAE,CAAC;KACZ;GACF;CACF,CAAC;;AAEF,QAAQ,CAAC,MAAM,CAAC,MAAM,CAAC;AACrB,uBAAqB,EAAC,UAAS,KAAK,EAAC;AACnC,SAAK,CAAC,cAAc,EAAE,CAAC;AACvB,QAAI,MAAM,GAAG,CAAC,CAAC,yBAAyB,CAAC,CAAC,GAAG,EAAE,CAAC;;AAEhD,YAAQ,CAAC,MAAM,CAAC,CAAC;GAClB;CACF,CAAC,CAAC;;AAEH,QAAQ,CAAC,UAAU,CAAC,MAAM,CAAC;AACzB,oBAAkB,EAAC,UAAS,KAAK,EAAC;AAChC,SAAK,CAAC,cAAc,EAAE,CAAC;;AAEvB,YAAQ,CAAC,EAAE,EAAC,YAAU;AACpB,aAAO,CAAC,gBAAgB,EAAE,CAAC;KAC5B,CAAC,CAAC;GACJ;CACF,CAAC,uE","file":"/client/views/rating.js","sourcesContent":["/**\n * Created by Junwei on 16/4/25.\n */\n\nTemplate.rating.helpers({\n  'showBack':function(){\n    FlowRouter.watchPathChange();\n    var close = FlowRouter.current().queryParams.close || 'agent';\n    if(close == 'visitor'){\n      return true;\n    }\n  },\n  'title':function(){\n    return Meteor.settings.public.tenant_livechat_settings.chatTitle;\n  },\n  'introMsg':function(){\n    FlowRouter.watchPathChange();\n    var close = FlowRouter.current().queryParams.close || 'agent';\n    return close ==='visitor'?Meteor.settings.public.tenant_livechat_settings.surveyByVisitor :Meteor.settings.public.tenant_livechat_settings.surveyByAgent;\n  }\n});\n\nvar submitRating = function(rating){\n  var tenantId = Meteor.settings.public.tenant_livechat_settings.tenantId || '';\n  Meteor.call(\"saveSatisfaction\", {\n    channelId: \"webchat\",\n    tenantId: tenantId,\n    messageId: visitor.getRoom(),\n    surveyResult: rating\n  }, function (error, result) {\n    if(rating){\n      FlowRouter.go('result',{type:'livechat'},{status:result});\n    }\n  });\n};\n\n//ÂõûË∞ÉËß£ÂÜ≥Áõ¥Êé•ÂÖ≥Èó≠ÊàøÈó¥‰ºöÈáçÊñ∞Âª∫ÊàøÈó¥ÂØºËá¥BUG\nvar doRating = function(rating,callback){\n  if(FlowRouter.current().queryParams.close == 'visitor'){\n    Session.set(\"whoEndMsg\", \"visitor\");\n    Meteor.call(\"visitorHideRoom\", visitor.getRoom(), function (error,result) {\n      submitRating(rating);\n      if(typeof callback == 'function'){\n        callback();\n      }\n    });\n  }else{\n    submitRating(rating);\n    if(typeof callback == 'function'){\n      callback();\n    }\n  }\n};\n\nTemplate.rating.events({\n  'submit .rating-form':function(event){\n    event.preventDefault();\n    var rating = $('[name=\"rating\"]:checked').val();\n    //Â¶ÇÊûúËÆøÂÆ¢‰∏ªÂä®ÂÖ≥Èó≠,ÂÖàÊúçÂä°Á´ØÂÖ≥Èó≠ÊàøÈó¥ÂÜçÊèê‰∫§.\n    doRating(rating);\n  }\n});\n\nTemplate.pageHeader.events({\n  'click .btn-close':function(event){\n    event.preventDefault();\n    //Â¶ÇÊûúÊòØËÆøÂÆ¢ÂÖ≥Èó≠ÁöÑ,Ë¶ÅÂÖ≥Èó≠ÊàøÈó¥.\n    doRating('',function(){\n      visitor.ticketOrLivechat();\n    });\n  }\n})\n"]}