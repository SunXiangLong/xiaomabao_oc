{"version":3,"sources":["meteor://💻app/client/lib/webBrowserAgent.js"],"names":[],"mappings":"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","file":"/client/lib/webBrowserAgent.js","sourcesContent":["/**\n * Created by lil on 16-4-22.\n */\n(function() {\n  if(Meteor.isCordova){\n    console.log(\"run in app of mobile.\")\n  }else{\n    console.log(\"run in web browser.\")\n    var Agent=function(){\n      var self=this;\n      var callParent=function(method, args) {\n        console.log(\"call parent\");\n        var data;\n        if (args == null) {\n          args = [];\n        }\n        data = {\n          src: 'rocketchat',\n          fn: method,\n          args: args\n        };\n        return window.parent.postMessage(JSON.stringify(data), '*');\n      };\n      self.toggleWindow=function(){\n        //切换窗口\n        callParent(\"toggleWindow\")\n      }\n      self.noticeNewMsg=function(msg){\n        callParent(\"noticeNewMsg\",msg);\n      }\n      self.receiveAWSUrl=function(data){\n        callParent(\"receiveAWSUrl\",{url:data.url,id:data.id});\n      }\n      self.imagePreview=function(data){\n        callParent(\"imagePreview\",{id:data.id,list:data.list});\n      }\n      self.closeWindow=function(){\n        callParent(\"closeWindow\");\n      }\n      self.signACK=function(msg){\n        //no need to send ack back to outer web browser\n        console.log(msg)\n      }\n      var message= null;\n      self.cacheUniqueSystemMessage=function(msg){\n        message = msg;\n      }\n      self.recoverUniqueSystemMessage=function(){\n        var result = message;\n        message = null;\n        return result;\n      }\n      var userInfo= null;\n      self.cacheUniqueUserInfo=function(msg){\n        userInfo = msg;\n      }\n      self.recoverUniqueUserInfo=function(){\n        var result = userInfo;\n        userInfo = null;\n        return result;\n      }\n      if(window.addEventListener){\n        window.addEventListener('message',function(msg){\n          receiveMessage(msg);\n        })\n      }else if (window.attachEvent){\n        window.attachEvent('onmessage', function (msg) {\n          receiveMessage(msg);\n        })\n      }\n      var receiveMessage=function(msg){\n        if(msg.data){\n          try{\n            var msgData =  eval(\"(\"+msg.data+\")\");\n            if (typeof msgData === 'object' && msgData.src !== undefined && msgData.src === 'livechat-parent') {\n              console.log('receiveMessage->',msg);\n              var args = [].concat(msgData.args || []);\n              return api[msgData.fn].apply(null, args);\n            }\n          }catch(e){\n            //msg.data is not a json string\n          }\n        }\n      }\n      var api={\n        transferToAWSUrl:function(message){\n          if(window[message.url]){\n            callParent('receiveAWSUrl',{url:window[message.url],id:message.id});\n          }else{\n            Meteor.call('awsGetSignedUrl', message.url, function (error, awsUrl) {\n              if (awsUrl !== null && awsUrl !== undefined){\n                callParent('receiveAWSUrl',{url:awsUrl,id:message.id});\n              }else{\n                callParent('receiveAWSUrl',{url:null,id:message.id});\n              }\n            })\n          }\n        }\n      }\n    }\n    this.outerAgent = new Agent();\n  }\n}).call(this);\n"]}